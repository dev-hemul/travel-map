name: Notify team on PR events
on:
  pull_request:
    types: [opened, reopened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ†•ðŸ”µ Notify when PR opened or reopened
        if: ${{ github.event.action == 'opened' || github.event.action == 'reopened' }}
        run: |
          MESSAGE=$(cat <<'EOF'
          ðŸ†•ðŸ”µ ÐÐ¾Ð²Ð¸Ð¹ Pull Request Ð²Ñ–Ð´ *${{ github.event.pull_request.user.login }}*

          *ÐÐ°Ð·Ð²Ð°:* ${{ github.event.pull_request.title }}
          *Ð“Ñ–Ð»ÐºÐ°:* ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}
          
          ðŸ”— [Ð”Ð¸Ð²Ð¸Ñ‚Ð¸ÑÑŒ PR](${{ github.event.pull_request.html_url }})
          EOF
          )

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
            --data-urlencode "chat_id=${{ secrets.TG_CHAT_ID }}" \
            --data-urlencode "parse_mode=Markdown" \
            --data-urlencode "text=$MESSAGE"

      - name: âœ…ðŸŸ¢ Notify when PR merged
        if: ${{ github.event.action == 'closed' && github.event.pull_request.merged == true }}
        run: |
          MESSAGE=$(cat <<'EOF'
          âœ…ðŸŸ¢ Pull Request *#${{ github.event.pull_request.number }}* Ð±ÑƒÐ² Ð·Ð»Ð¸Ñ‚Ð¸Ð¹ Ð² Ð³Ñ–Ð»ÐºÑƒ *${{ github.event.pull_request.base.ref }}*

          ÐÐ²Ñ‚Ð¾Ñ€: ${{ github.event.pull_request.user.login }}
          
          ðŸ”— [Ð”Ð¸Ð²Ð¸Ñ‚Ð¸ÑÑŒ PR](${{ github.event.pull_request.html_url }})

          ðŸ‘‰ ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ `git pull`!
          EOF
          )

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
            --data-urlencode "chat_id=${{ secrets.TG_CHAT_ID }}" \
            --data-urlencode "parse_mode=Markdown" \
            --data-urlencode "text=$MESSAGE"

      - name: âŒðŸ”´ Notify when PR closed without merge
        if: ${{ github.event.action == 'closed' && github.event.pull_request.merged == false }}
        run: |
          MESSAGE=$(cat <<'EOF'
          âŒðŸ”´ Pull Request *#${{ github.event.pull_request.number }}* Ð±ÑƒÐ² Ð·Ð°ÐºÑ€Ð¸Ñ‚Ð¸Ð¹ Ð±ÐµÐ· merge.

          ÐÐ²Ñ‚Ð¾Ñ€: ${{ github.event.pull_request.user.login }}
          
          ðŸ”— [Ð”Ð¸Ð²Ð¸Ñ‚Ð¸ÑÑŒ PR](${{ github.event.pull_request.html_url }})
          EOF
          )

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
            --data-urlencode "chat_id=${{ secrets.TG_CHAT_ID }}" \
            --data-urlencode "parse_mode=Markdown" \
            --data-urlencode "text=$MESSAGE"
